---
  - name: Create jenkins group
    group:
      name: "{{ jenkins_config_group }}"
      state: present
  
  - name: Create jenkins user
    user:
      name: "{{ jenkins_config_owner }}"
      group: "{{ jenkins_config_group }}"
      home: "{{ jenkins_home }}"
      shell: /bin/false
      state: present
  
  - name: Add Jenkins Key
    apt_key:
      url: "https://pkg.jenkins.io/debian/jenkins.io.key"
      state: present

  - name: Add Jenkins stable repo
    apt_repository:
      repo: 'deb https://pkg.jenkins.io/debian-stable binary/'
      state: present
      filename: jenkins

  - name: Update apt cache
    apt:
      update_cache: yes
  
  - name: Download specific version of Jenkins
    get_url:
      url: "https://pkg.jenkins.io/debian-stable/binary/jenkins_{{ jenkins_version }}_all.deb"
      dest: /tmp/jenkins_{{ jenkins_version }}_all.deb

  - name: Install specific version of Jenkins
    apt:
      deb: /tmp/jenkins_{{ jenkins_version }}_all.deb
      state: present
    notify: setup admin user
  
  # Customize Jenkins settings
  - include_tasks: settings.yml
